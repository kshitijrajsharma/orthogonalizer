import json

import pytest

from orthogonalizer import othogonalize_poly


@pytest.fixture
def input_featurecol():
    input_ftc = {
        "type": "FeatureCollection",
        "crs": {
            "type": "name",
            "properties": {"name": "urn:ogc:def:crs:OGC:1.3:CRS84"},
        },
        "features": [
            {
                "type": "Feature",
                "properties": {"building": "yes", "source": "fAIr"},
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [85.52282989025116, 27.633874583566897],
                            [85.5229452252388, 27.63382943484318],
                            [85.52296802401541, 27.63381398922289],
                            [85.52294388413429, 27.633770028599383],
                            [85.52294254302979, 27.633737949214325],
                            [85.52289828658104, 27.633657156647338],
                            [85.52288219332696, 27.633634582242948],
                            [85.52286610007285, 27.633629829736172],
                            [85.52284732460976, 27.633594185928754],
                            [85.52283391356468, 27.633592997801635],
                            [85.5227641761303, 27.633626265355954],
                            [85.52275210618974, 27.633602502818196],
                            [85.52279770374298, 27.63358468091148],
                            [85.52282184362413, 27.63358586903869],
                            [85.52284196019174, 27.633570423384025],
                            [85.52290499210358, 27.633546660834142],
                            [85.52291437983514, 27.6335335914295],
                            [85.52288487553596, 27.63349913571889],
                            [85.52287682890892, 27.633477749410297],
                            [85.52286744117737, 27.633475373153523],
                            [85.52279099822043, 27.633497947590747],
                            [85.52278697490691, 27.633507452615547],
                            [85.52279770374298, 27.633531215173953],
                            [85.52277490496635, 27.633537155812736],
                            [85.5227641761303, 27.633519333895393],
                            [85.52277088165283, 27.633512205127637],
                            [85.52276819944382, 27.633500323847024],
                            [85.52275612950326, 27.633478937538655],
                            [85.52279233932495, 27.63347062063983],
                            [85.52277758717538, 27.633423095491562],
                            [85.52273064851761, 27.633440917424576],
                            [85.52271991968156, 27.633462303740373],
                            [85.52270114421846, 27.63343378865172],
                            [85.52265822887422, 27.633445669939558],
                            [85.52264615893363, 27.63345873935469],
                            [85.52263274788858, 27.63343735303821],
                            [85.5226247012615, 27.63343735303821],
                            [85.52260860800743, 27.633446858068275],
                            [85.5226032435894, 27.63346349186891],
                            [85.52252545952797, 27.633512205127637],
                            [85.52251875400543, 27.63352408640697],
                            [85.52255228161812, 27.633565670874464],
                            [85.52256569266319, 27.633570423384025],
                            [85.52262872457506, 27.63353240330173],
                            [85.52263543009758, 27.633518145767464],
                            [85.52265822887422, 27.633505076359423],
                            [85.52266359329224, 27.633507452615547],
                            [85.52267700433731, 27.63353953206817],
                            [85.52267298102379, 27.633562106492153],
                            [85.52269712090492, 27.633616760341468],
                            [85.52268639206885, 27.633633394116277],
                            [85.52271857857704, 27.63368685980389],
                            [85.5227279663086, 27.633690424182145],
                            [85.5227279663086, 27.633704681693967],
                            [85.52282989025116, 27.633874583566897],
                        ]
                    ],
                },
            }
        ],
    }
    return input_ftc


@pytest.fixture
def input_geom():
    input_ftc = {
        "type": "Polygon",
        "coordinates": [
            [
                [85.52282989025116, 27.633874583566897],
                [85.5229452252388, 27.63382943484318],
                [85.52296802401541, 27.63381398922289],
                [85.52294388413429, 27.633770028599383],
                [85.52294254302979, 27.633737949214325],
                [85.52289828658104, 27.633657156647338],
                [85.52288219332696, 27.633634582242948],
                [85.52286610007285, 27.633629829736172],
                [85.52284732460976, 27.633594185928754],
                [85.52283391356468, 27.633592997801635],
                [85.5227641761303, 27.633626265355954],
                [85.52275210618974, 27.633602502818196],
                [85.52279770374298, 27.63358468091148],
                [85.52282184362413, 27.63358586903869],
                [85.52284196019174, 27.633570423384025],
                [85.52290499210358, 27.633546660834142],
                [85.52291437983514, 27.6335335914295],
                [85.52288487553596, 27.63349913571889],
                [85.52287682890892, 27.633477749410297],
                [85.52286744117737, 27.633475373153523],
                [85.52279099822043, 27.633497947590747],
                [85.52278697490691, 27.633507452615547],
                [85.52279770374298, 27.633531215173953],
                [85.52277490496635, 27.633537155812736],
                [85.5227641761303, 27.633519333895393],
                [85.52277088165283, 27.633512205127637],
                [85.52276819944382, 27.633500323847024],
                [85.52275612950326, 27.633478937538655],
                [85.52279233932495, 27.63347062063983],
                [85.52277758717538, 27.633423095491562],
                [85.52273064851761, 27.633440917424576],
                [85.52271991968156, 27.633462303740373],
                [85.52270114421846, 27.63343378865172],
                [85.52265822887422, 27.633445669939558],
                [85.52264615893363, 27.63345873935469],
                [85.52263274788858, 27.63343735303821],
                [85.5226247012615, 27.63343735303821],
                [85.52260860800743, 27.633446858068275],
                [85.5226032435894, 27.63346349186891],
                [85.52252545952797, 27.633512205127637],
                [85.52251875400543, 27.63352408640697],
                [85.52255228161812, 27.633565670874464],
                [85.52256569266319, 27.633570423384025],
                [85.52262872457506, 27.63353240330173],
                [85.52263543009758, 27.633518145767464],
                [85.52265822887422, 27.633505076359423],
                [85.52266359329224, 27.633507452615547],
                [85.52267700433731, 27.63353953206817],
                [85.52267298102379, 27.633562106492153],
                [85.52269712090492, 27.633616760341468],
                [85.52268639206885, 27.633633394116277],
                [85.52271857857704, 27.63368685980389],
                [85.5227279663086, 27.633690424182145],
                [85.5227279663086, 27.633704681693967],
                [85.52282989025116, 27.633874583566897],
            ]
        ],
    }
    return input_ftc


def test_featurecollection(input_featurecol):
    orthogonalized_poly = othogonalize_poly(input_featurecol)
    assert len(orthogonalized_poly["features"]) == 1


def test_single_geom(input_geom):
    orthogonalized_poly = othogonalize_poly(input_geom)
    assert len(orthogonalized_poly["coordinates"]) >= 1
